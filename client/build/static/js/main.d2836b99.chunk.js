(this["webpackJsonpethcoupon-finalproject-react"]=this["webpackJsonpethcoupon-finalproject-react"]||[]).push([[0],{234:function(t,e,n){},249:function(t,e){},251:function(t,e){},253:function(t,e){},257:function(t,e){},284:function(t,e){},286:function(t,e){},295:function(t,e){},297:function(t,e){},307:function(t,e){},309:function(t,e){},430:function(t,e){},432:function(t,e){},439:function(t,e){},440:function(t,e){},533:function(t,e,n){"use strict";n.r(e);var o=n(1),a=n.n(o),s=n(35),i=n.n(s),r=(n(234),n(29)),c=n(13),l=n.n(c),u=n(18),d=n(5),h=n(7),p=n(12),m=n(11),b=(n.p,n(78),n(9)),j=n.n(b),x="0xE11291A837C7d72D05381d3c89F8292851fFFaFf",f=[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"couponHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"date",type:"uint256"}],name:"CollectLeftOver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"couponHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"sponsorAddress",type:"address"},{indexed:!0,internalType:"address",name:"targetAddress",type:"address"},{indexed:!1,internalType:"string",name:"couponCode",type:"string"},{indexed:!1,internalType:"uint256",name:"totalEth",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amtPerAddress",type:"uint256"},{indexed:!1,internalType:"uint256",name:"startDate",type:"uint256"},{indexed:!1,internalType:"uint256",name:"endDate",type:"uint256"},{indexed:!1,internalType:"uint256",name:"minRedeemAmt",type:"uint256"},{indexed:!1,internalType:"uint256",name:"maxRedeemAmt",type:"uint256"},{indexed:!1,internalType:"uint256",name:"dateCreated",type:"uint256"}],name:"Promotion",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"couponHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"user",type:"address"},{indexed:!1,internalType:"bytes32",name:"RedeemID",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"date",type:"uint256"}],name:"Redeem",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"string",name:"couponHash",type:"string"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"date",type:"uint256"}],name:"TopUp",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"RedeemID",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"couponAmt",type:"uint256"},{indexed:!1,internalType:"uint256",name:"walletAmt",type:"uint256"}],name:"Transaction",type:"event"},{constant:!1,inputs:[{internalType:"string",name:"promoCode",type:"string"},{internalType:"uint256",name:"totalPerAddress",type:"uint256"},{internalType:"address",name:"targetAddress",type:"address"},{internalType:"uint256",name:"startDate",type:"uint256"},{internalType:"uint256",name:"endDate",type:"uint256"},{internalType:"uint256",name:"minRedeemAmt",type:"uint256"},{internalType:"uint256",name:"maxRedeemAmt",type:"uint256"}],name:"mint",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"collectLeftoverEther",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"topUp",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"checkPromotionalBalance",outputs:[{internalType:"uint256",name:"leftOver",type:"uint256"},{internalType:"uint256",name:"unspentEther",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"redeem",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"string",name:"promoCode",type:"string"},{internalType:"uint256",name:"couponAmt",type:"uint256"}],name:"transaction",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"checkCouponBalance",outputs:[{internalType:"uint256",name:"amt",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"string",name:"promoCode",type:"string"}],name:"checkPromotionDetails",outputs:[{internalType:"uint256",name:"totalPerAddress",type:"uint256"},{internalType:"bool",name:"isPromoValid",type:"bool"},{internalType:"address",name:"targetAddress",type:"address"},{internalType:"uint256",name:"startDate",type:"uint256"},{internalType:"uint256",name:"endDate",type:"uint256"},{internalType:"uint256",name:"minRedeemAmt",type:"uint256"},{internalType:"uint256",name:"maxRedeemAmt",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],y=n(538);function g(t,e){return new Promise((function(n,o){var a=[];t.getPastEvents("Promotion",{filter:{sponsorAddress:e},fromBlock:0,toBlock:"latest"},(function(t,e){if(console.log(e),e.length>0){for(var o=0;o<e.length;o++)a.push(e[o].returnValues);n(a)}})).then((function(t){}))}))}function v(t,e){return new Promise((function(n,o){var a=[];t.getPastEvents("Promotion",{filter:{couponHash:e},fromBlock:0,toBlock:"latest"},(function(t,e){console.log(e),e.length>0&&a.push(e[0].returnValues),n(a)})).then((function(t){}))}))}function O(t,e){return new Promise((function(n,o){var a=[];t.getPastEvents("Redeem",{filter:{user:e},fromBlock:0,toBlock:"latest"},(function(t,e){if(console.log(e),e.length>0){for(var o=0;o<e.length;o++)a.push(e[o].returnValues);n(a)}})).then((function(t){}))}))}function C(t,e,n){return new Promise((function(o,a){var s=[];t.getPastEvents("Redeem",{filter:{couponHash:e,user:n},fromBlock:0,toBlock:"latest"},(function(t,e){console.log(e),e.length>0&&s.push(e[0].returnValues),o(s)})).then((function(t){}))}))}function w(t,e){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(l.a.mark((function t(e,n){var o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O(e,n);case 2:o=t.sent,a=0;case 4:if(!(a<o.length)){t.next=13;break}return t.next=7,v(e,o[a][0]);case 7:s=t.sent,console.log(s),s.length>0&&(o[a].couponCode=s[0].couponCode,o[a].startDate=s[0].startDate,o[a].endDate=s[0].endDate,o[a].endDate=s[0].endDate,o[a].amtPerAddress=s[0].amtPerAddress,o[a].minRedeemAmt=s[0].minRedeemAmt,o[a].maxRedeemAmt=s[0].maxRedeemAmt,o[a].targetAddress=s[0].targetAddress);case 10:a++,t.next=4;break;case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,e,n){return new Promise((function(o,a){t.methods.checkPromotionalBalance(n).call({from:e}).then((function(t){return console.log(t),o(t)}))}))}function A(t,e,n){return new Promise((function(o,a){t.methods.checkCouponBalance(n).call({from:e}).then((function(t){return console.log(t),o(t)}))}))}function D(t,e){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(l.a.mark((function t(e,n){var o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(e,n);case 2:o=t.sent,a=0;case 4:if(!(a<o.length)){t.next=15;break}return console.log("Promotion code is "+o[a].couponCode),t.next=8,k(e,n,o[a].couponCode);case 8:s=t.sent,console.log("Coupon "+o[a].couponCode+" still has "+s.leftOver),o[a].Balance=s.leftOver,o[a].unspentEther=s.unspentEther;case 12:a++,t.next=4;break;case 15:return t.abrupt("return",o);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(t,e){return M.apply(this,arguments)}function M(){return(M=Object(u.a)(l.a.mark((function t(e,n){var o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w(e,n);case 2:o=t.sent,a=0;case 4:if(!(a<o.length)){t.next=15;break}return console.log("Coupon code is "+o[a].couponCode),t.next=8,A(e,n,o[a].couponCode);case 8:s=t.sent,console.log("Coupon "+o[a].couponCode+" still has "+s),o[a].Balance=s,console.log(o);case 12:a++,t.next=4;break;case 15:return t.abrupt("return",o);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var B=n(0),E=function(t){Object(p.a)(n,t);var e=Object(m.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).state={testData:"",promoCode:""},o.open=o.open.bind(Object(r.a)(o)),o.close=o.close.bind(Object(r.a)(o)),o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.loadBlockchainData(),this.TopUpFunds=this.TopUpFunds.bind(this),this.reclaimEthers=this.reclaimEthers.bind(this),this.showTopUpModal=this.showTopUpModal.bind(this),this.toStoreAmount=this.toStoreAmount.bind(this)}},{key:"toStoreAmount",value:function(t){this.setState({amount:t.target.value}),console.log(t.target.value)}},{key:"showTopUpModal",value:function(t){t.preventDefault();var e=t.currentTarget.value;this.setState({promoCode:e}),this.open()}},{key:"loadBlockchainData",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getChainId();case 3:return n=t.sent,console.log(n),this.setState({accountInfo:""}),o=new e.eth.Contract(f,x),t.next=9,e.eth.getAccounts();case 9:return a=t.sent,this,[],[],s=[],[],[],t.next=18,D(o,a[0]);case 18:s=t.sent,console.log(s),this.setState({testData:s}),console.log("from Home"),console.log(this.state.testData);case 23:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"open",value:function(){this.setState({showModal:!0})}},{key:"close",value:function(){this.setState({showModal:!1})}},{key:"TopUpFunds",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getAccounts();case 3:n=t.sent,o=new e.eth.Contract(f,x),a=e.utils.toWei(this.state.amount.toString(),"ether"),s=this,o.methods.topUp(this.state.promoCode).send({from:n[0],value:a}).on("transactionHash",(function(t){1==window.confirm("Promotion top up pending. User will be notified once it is confirmed. Click Ok to check transaction status.")&&window.open("https://ropsten.etherscan.io/tx/"+t),s.close()})).on("receipt",(function(t){alert("Promotion top up success"),window.location.reload(!0)})).on("error",(function(t){alert(t)}));case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"reclaimEthers",value:function(){var t=Object(u.a)(l.a.mark((function t(e){var n,o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),n=e.currentTarget.value,o=new j.a(j.a.givenProvider),t.next=5,o.eth.getAccounts();case 5:a=t.sent,s=new o.eth.Contract(f,x),this,s.methods.collectLeftoverEther(n).send({from:a[0]}).on("transactionHash",(function(t){1==window.confirm("Ether withdrawal pending. User will be notified once it is confirmed. Click Ok to check transaction status.")&&window.open("https://ropsten.etherscan.io/tx/"+t)})).on("receipt",(function(t){console.log(t),alert(o.utils.fromWei(t.events.CollectLeftOver.returnValues.amount,"ether")+" unspent remaining Ether reclaimed by user"),window.location.reload(!0)})).on("error",(function(t){console.log(t),alert(t)}));case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.props.header,n=this.state.testData;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)("table",{class:"table table-striped",children:[Object(B.jsx)("thead",{children:Object(B.jsx)("tr",{children:e.map((function(t){return Object(B.jsx)("th",{children:t})}))})}),Object(B.jsx)("tbody",{children:function(){console.log("List data is "),console.log(n);for(var e=[],o=function(o){new Date>new Date(1e3*n[o].endDate)&&0==j.a.utils.fromWei(j.a.utils.toBN(n[o].Balance),"ether")||e.push(Object(B.jsxs)("tr",{children:[Object(B.jsxs)("td",{children:[" ",new Date>new Date(1e3*n[o].endDate)?Object(B.jsx)(B.Fragment,{children:Object(B.jsx)("button",{type:"button",class:"btn",title:"Reclaim unspent Ethers",value:n[o].couponCode,onClick:t.reclaimEthers,children:Object(B.jsx)("i",{class:"fa fa-times"})})}):Object(B.jsx)(B.Fragment,{children:Object(B.jsx)("button",{type:"button",class:"btn",title:"Top up promotion",value:n[o].couponCode,onClick:t.showTopUpModal,children:Object(B.jsx)("i",{class:"fa fa-credit-card"})})})]}),Object(B.jsx)("td",{children:n[o].couponCode}),Object(B.jsx)("td",{children:new Date(1e3*n[o].dateCreated).toLocaleString()}),Object(B.jsx)("td",{children:n[o].targetAddress}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].totalEth),"ether")}),Object(B.jsx)("td",{children:Object(B.jsx)("b",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].Balance),"ether")})}),Object(B.jsx)("td",{children:new Date(1e3*n[o].startDate).toLocaleString()}),Object(B.jsx)("td",{children:new Date(1e3*n[o].endDate).toLocaleString()}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].amtPerAddress),"ether")}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].minRedeemAmt),"ether")}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].maxRedeemAmt),"ether")})]}))},a=0;a<n.length;a++)o(a);return e}()})]}),Object(B.jsxs)(y.a,{className:"modalTopUp",show:this.state.showModal,onHide:this.close,animation:!0,bsSize:"small",children:[Object(B.jsx)(y.a.Header,{closeButton:!0,children:Object(B.jsx)(y.a.Title,{children:"Top Up Promotion Funds"})}),Object(B.jsx)(y.a.Body,{children:Object(B.jsxs)("table",{children:[Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{style:{width:"200px"},children:"Promotion code:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtPromoCode",value:this.state.promoCode,onChange:this.toStorePromoCode,disabled:!0})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Amount top up(eth):"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtAmt",value:this.state.amount,onChange:this.toStoreAmount})})]})]})}),Object(B.jsxs)(y.a.Footer,{children:[Object(B.jsx)("button",{type:"button",class:"btn btn-success",onClick:this.TopUpFunds,id:"btn_TopUp",children:"Top Up Promotion Funds"}),Object(B.jsx)("button",{type:"button",class:"btn btn-danger",onClick:this.close,children:"Close"})]})]})]})}}]),n}(a.a.Component),R=E,W=n(77),I=n(14),F=function(t){Object(p.a)(n,t);var e=Object(m.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).state={testData:""},o.open=o.open.bind(Object(r.a)(o)),o.close=o.close.bind(Object(r.a)(o)),o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.loadBlockchainData(),this.toStoreCouponAmt=this.toStoreCouponAmt.bind(this),this.toStoreWalletAmt=this.toStoreWalletAmt.bind(this),this.showTransactionModal=this.showTransactionModal.bind(this),this.PerformTransaction=this.PerformTransaction.bind(this)}},{key:"toStoreCouponAmt",value:function(t){this.setState({couponAmt:t.target.value}),console.log(t.target.value)}},{key:"toStoreWalletAmt",value:function(t){this.setState({walletAmt:t.target.value}),console.log(t.target.value)}},{key:"showTransactionModal",value:function(t){t.preventDefault();var e=t.currentTarget.value;this.setState({promoCode:e}),this.open()}},{key:"loadBlockchainData",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getChainId();case 3:return n=t.sent,console.log(n),this.setState({accountInfo:""}),o=new e.eth.Contract(f,x),t.next=9,e.eth.getAccounts();case 9:return a=t.sent,this,[],[],s=[],[],[],t.next=18,P(o,a[0]);case 18:s=t.sent,console.log("Promo data is "),console.log(s),this.setState({testData:s}),console.log("from Home"),console.log(this.state.testData);case 24:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"PerformTransaction",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getAccounts();case 3:n=t.sent,o=new e.eth.Contract(f,x),a=this.state.couponAmt,s=this.state.walletAmt,console.log("state value is "+a),console.log("state value is "+s),a=e.utils.toWei(a,"ether"),s=e.utils.toWei(s,"ether"),i=this,o.methods.transaction(this.state.promoCode,a).send({from:n[0],value:s}).on("transactionHash",(function(t){1==window.confirm("Transaction pending. User will be notified once it is confirmed. Click Ok to check transaction status.")&&window.open("https://ropsten.etherscan.io/tx/"+t),i.close()})).on("receipt",(function(t){alert("Transaction success"),window.location.reload(!0)})).on("error",(function(t){alert(t)}));case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"open",value:function(){this.setState({showModal:!0})}},{key:"close",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var t=this,e=this.props.header,n=this.state.testData;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)("table",{class:"table table-striped",children:[Object(B.jsx)("thead",{children:Object(B.jsx)("tr",{children:e.map((function(t){return Object(B.jsx)("th",{children:t})}))})}),Object(B.jsx)("tbody",{children:function(){for(var e=[],o=function(o){new Date>new Date(1e3*n[o].endDate)||e.push(Object(B.jsxs)("tr",{children:[Object(B.jsxs)("td",{children:[" ",function(){if(j.a.utils.fromWei(j.a.utils.toBN(n[o].Balance),"ether")>0)return Object(B.jsx)(B.Fragment,{children:Object(B.jsx)("button",{type:"button",class:"btn",title:"Spend coupon value",value:n[o].couponCode,onClick:t.showTransactionModal,children:Object(B.jsx)("i",{class:"fa fa-credit-card"})})})}()]}),Object(B.jsx)("td",{children:n[o].couponCode}),Object(B.jsx)("td",{children:new Date(1e3*n[o].date).toLocaleString()}),Object(B.jsx)("td",{children:n[o].targetAddress}),Object(B.jsx)("td",{children:new Date(1e3*n[o].startDate).toLocaleString()}),Object(B.jsx)("td",{children:new Date(1e3*n[o].endDate).toLocaleString()}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].amtPerAddress),"ether")}),Object(B.jsx)("td",{children:Object(B.jsx)("b",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].Balance),"ether")})}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].minRedeemAmt),"ether")}),Object(B.jsx)("td",{children:j.a.utils.fromWei(j.a.utils.toBN(n[o].maxRedeemAmt),"ether")})]}))},a=0;a<n.length;a++)o(a);return e}()})]}),Object(B.jsxs)(y.a,{className:"modalTransaction",show:this.state.showModal,onHide:this.close,animation:!0,bsSize:"small",children:[Object(B.jsx)(y.a.Header,{closeButton:!0,children:Object(B.jsx)(y.a.Title,{children:"Spend coupon value"})}),Object(B.jsx)(y.a.Body,{children:Object(B.jsxs)("table",{children:[Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{style:{width:"200px"},children:"Promotion code:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtPromoCode",value:this.state.promoCode,onChange:this.toStorePromoCode,disabled:!0})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Coupon amount(eth):"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtCouponAmt",value:this.state.couponAmt,onChange:this.toStoreCouponAmt})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Wallet amount(eth):"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtWalletAmt",value:this.state.walletAmt,onChange:this.toStoreWalletAmt})})]})]})}),Object(B.jsxs)(y.a.Footer,{children:[Object(B.jsx)("button",{type:"button",class:"btn btn-success",onClick:this.PerformTransaction,id:"btn_transaction",children:"Perform Transaction"}),Object(B.jsx)("button",{type:"button",class:"btn btn-danger",onClick:this.close,children:"Close"})]})]})]})}}]),n}(a.a.Component),N=F,H=function(t){Object(p.a)(n,t);var e=Object(m.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).state={promoCode:""},o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.loadBlockchainData(),this.toStorePromoCode=this.toStorePromoCode.bind(this),this.RedeemPromotion=this.RedeemPromotion.bind(this)}},{key:"loadBlockchainData",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getChainId();case 3:return n=t.sent,console.log(n),o=document.querySelector("#btn_RedeemPromotion"),3!=n?(alert("Incorrect chain ID. This application only runs on Ropsten"),o.disabled=!0):o.disabled=!1,this.setState({accountInfo:""}),a=new e.eth.Contract(f,x),t.next=11,e.eth.getAccounts();case 11:return s=t.sent,this,i=[],t.next=16,w(a,s[0]);case 16:i=t.sent,console.log(i);case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"RedeemPromotion",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getAccounts();case 3:return n=t.sent,o=new e.eth.Contract(f,x),console.log(n[0]),console.log(this.state.promoCode),t.next=9,C(o,e.utils.keccak256(this.state.promoCode),n[0]);case 9:if(0!=t.sent){t.next=17;break}return t.next=13,v(o,e.utils.keccak256(this.state.promoCode));case 13:0!=t.sent?o.methods.redeem(this.state.promoCode).send({from:n[0]}).on("transactionHash",(function(t){1==window.confirm("Coupon redeem pending. User will be notified once it is confirmed. Click Ok to check transaction status.")&&window.open("https://ropsten.etherscan.io/tx/"+t)})).on("receipt",(function(t){alert("Coupon redeem success"),window.location.reload(!0)})).on("error",(function(t){alert(t)})):alert("Coupon Does not exist"),t.next=18;break;case 17:alert("User has already redemeed the coupon");case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"toStorePromoCode",value:function(t){this.setState({promoCode:t.target.value}),console.log(t.target.value)}},{key:"render",value:function(){return Object(B.jsx)("div",{class:"container mt-5",children:Object(B.jsxs)("div",{class:"row",children:[Object(B.jsx)("div",{style:{textAlign:"right"},children:Object(B.jsx)("table",{style:{float:"right"},children:Object(B.jsxs)("tr",{children:[Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtPromoCode",id:"txtPromoCode",value:this.state.promoCode,onChange:this.toStorePromoCode})}),Object(B.jsx)("td",{children:Object(B.jsx)("button",{type:"button",class:"btn btn-success",onClick:this.RedeemPromotion,id:"btn_RedeemPromotion",children:"Redeem Coupon"})})]})})}),Object(B.jsx)("h5",{children:"My coupons"}),Object(B.jsx)("hr",{}),Object(B.jsx)("br",{}),Object(B.jsx)("br",{}),Object(B.jsx)(N,{header:["","Promotion Code","Date Redeemed","Target account","Starting Date","Ending Date","Redeemed Ether","Current Balance","Min Coupon Txn Amount","Max coupon txn amount"]})]})})}}]),n}(a.a.Component),U=H,L=function(t){Object(p.a)(n,t);var e=Object(m.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).state={accountInfo:""},o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.loadBlockchainData(),this.Connect=this.Connect.bind(this)}},{key:"Connect",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.ethereum){t.next=12;break}return t.next=3,window.ethereum.enable();case 3:e=t.sent,n="<b>Current Account:</b> "+e+"   ",o=this,new j.a(j.a.givenProvider).eth.getBalance(e.toString(),(function(t,e){if(t)console.log(t);else{var a=j.a.utils.fromWei(e,"ether")+" <b>ETH</b>";n=n+" "+a,console.log(n),o.setState({accountInfo:n}),document.getElementById("btn_connectWallet").style.display="none"}})),console.log(n),this.setState({accountInfo:n}),t.next=13;break;case 12:alert("Metamask not installed");case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadBlockchainData",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getChainId();case 3:return n=t.sent,console.log("Chain ID is "+n),this.setState({accountInfo:""}),o=new e.eth.Contract(f,x),t.next=9,e.eth.getAccounts();case 9:return a=t.sent,this,[],[],s=[],[],[],t.next=18,g(o,a[0]);case 18:s=t.sent,console.log("from App"),console.log(s);case 21:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return Object(B.jsxs)("div",{class:"container",children:[Object(B.jsxs)("div",{class:"p-5 bg-primary text-white text-center",children:[Object(B.jsx)("h1",{children:"EthCoupon"}),Object(B.jsx)("p",{children:"Get free Ether to spend on products and services"})]}),Object(B.jsxs)(W.a,{basename:"/",children:[Object(B.jsx)("nav",{class:"navbar navbar-expand-sm bg-dark navbar-dark",children:Object(B.jsxs)("div",{class:"container-fluid",children:[Object(B.jsxs)("ul",{class:"navbar-nav me-auto",children:[Object(B.jsx)("li",{class:"nav-item",children:Object(B.jsx)(W.b,{to:"/",class:"nav-link active",children:"My Promotions"})}),Object(B.jsx)("li",{class:"nav-item",children:Object(B.jsx)(W.b,{to:"/myCoupon",class:"nav-link active",children:"My Coupons"})})]}),Object(B.jsx)("ul",{class:"navbar-nav",children:Object(B.jsxs)("li",{class:"nav-item",style:{color:"#fff"},children:[Object(B.jsxs)("div",{id:"lblAcctInfo",style:{display:"inline"},children:[Object(B.jsx)("div",{style:{display:"inline"},dangerouslySetInnerHTML:{__html:this.state.accountInfo}}),"\xa0\xa0\xa0"]}),Object(B.jsx)("button",{type:"button",class:"btn btn-primary",id:"btn_connectWallet",onClick:this.Connect,children:"Connect Wallet"})]})})]})}),Object(B.jsxs)(I.c,{children:[Object(B.jsx)(I.a,{path:"/",element:Object(B.jsx)(_,{})}),Object(B.jsx)(I.a,{path:"/myCoupon",element:Object(B.jsx)(U,{})})]})]})]})}}]),n}(a.a.Component),_=function(t){Object(p.a)(n,t);var e=Object(m.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).state={promoCode:"",account:"",ether:"",startDate:"",endDate:"",minSpendingAmt:"",maxSpendingAmt:"",amount:"",testData:""},o.open=o.open.bind(Object(r.a)(o)),o.close=o.close.bind(Object(r.a)(o)),o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.checkChainID(),this.CreateNewPromotion=this.CreateNewPromotion.bind(this),this.toStorePromoCode=this.toStorePromoCode.bind(this),this.toStoreAccount=this.toStoreAccount.bind(this),this.toStoreEther=this.toStoreEther.bind(this),this.toStoreStartDate=this.toStoreStartDate.bind(this),this.toStoreEndDate=this.toStoreEndDate.bind(this),this.toStoreMinSpendingAmt=this.toStoreMinSpendingAmt.bind(this),this.toStoreMaxSpendingAmt=this.toStoreMaxSpendingAmt.bind(this),this.toStoreAmount=this.toStoreAmount.bind(this)}},{key:"toStorePromoCode",value:function(t){this.setState({promoCode:t.target.value}),console.log(t.target.value)}},{key:"toStoreAccount",value:function(t){this.setState({account:t.target.value}),console.log(t.target.value)}},{key:"toStoreEther",value:function(t){this.setState({ether:t.target.value}),console.log(t.target.value)}},{key:"toStoreAmount",value:function(t){this.setState({amount:t.target.value}),console.log(t.target.value)}},{key:"toStoreStartDate",value:function(t){this.setState({startDate:t.target.value}),console.log(t.target.value)}},{key:"toStoreEndDate",value:function(t){this.setState({endDate:t.target.value}),console.log(t.target.value)}},{key:"toStoreMinSpendingAmt",value:function(t){this.setState({minSpendingAmt:t.target.value}),console.log(t.target.value)}},{key:"toStoreMaxSpendingAmt",value:function(t){this.setState({maxSpendingAmt:t.target.value}),console.log(t.target.value)}},{key:"checkChainID",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getChainId();case 3:return n=t.sent,console.log(n),this.setState({accountInfo:""}),new e.eth.Contract(f,x),t.next=9,e.eth.getAccounts();case 9:t.sent,o=document.querySelector("#btn_AddPromotion"),3!=n?(alert("Incorrect chain ID. This application only runs on Ropsten"),o.disabled=!0):o.disabled=!1;case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"CreateNewPromotion",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,o,a,s,i,r,c,u,d;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a(j.a.givenProvider),t.next=3,e.eth.getAccounts();case 3:return n=t.sent,o=new e.eth.Contract(f,x),a=e.utils.toWei(this.state.ether.toString(),"ether"),s=e.utils.toWei(this.state.amount,"ether"),i=e.utils.toWei(this.state.minSpendingAmt,"ether"),r=e.utils.toWei(this.state.maxSpendingAmt,"ether"),c=Math.round(new Date(this.state.startDate.toString()).getTime()/1e3),u=Math.round(new Date(this.state.endDate.toString()).getTime()/1e3),console.log(n[0]),d=this,t.next=15,v(o,e.utils.keccak256(this.state.promoCode));case 15:0==t.sent?o.methods.mint(this.state.promoCode,a,this.state.account,c,u,i,r).send({from:n[0],value:s}).on("transactionHash",(function(t){1==window.confirm("Promotion creation pending. User will be notified once it is confirmed. Click Ok to check transaction status.")&&window.open("https://ropsten.etherscan.io/tx/"+t),d.close()})).on("receipt",(function(t){alert("Promotion add success"),d.close(),window.location.reload(!0)})).on("error",(function(t){alert(t)})):alert("Promotion code already exists");case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"open",value:function(){this.setState({showModal:!0})}},{key:"close",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)("div",{class:"container mt-5",children:Object(B.jsxs)("div",{class:"row",children:[Object(B.jsx)("div",{style:{textAlign:"right"},children:Object(B.jsx)("button",{type:"button",class:"btn btn-success",onClick:this.open,id:"btn_AddPromotion",children:"Add New Promotion"})}),Object(B.jsx)("h5",{children:"My Promotions"}),Object(B.jsx)("hr",{}),Object(B.jsx)("br",{})]})}),Object(B.jsx)(R,{header:["","Promotion Code","Date Created","Target account","Starting Ether balance","Present Ether Balance","Starting Date","Ending Date","Ether per Account","Min coupon txn amount","Max coupon txn amount"]}),Object(B.jsxs)(y.a,{className:"myModal1",show:this.state.showModal,onHide:this.close,animation:!0,bsSize:"small",children:[Object(B.jsx)(y.a.Header,{closeButton:!0,children:Object(B.jsx)(y.a.Title,{children:"Create New Promotion"})}),Object(B.jsx)(y.a.Body,{children:Object(B.jsxs)("table",{children:[Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{style:{width:"200px"},children:"Promotion code:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtPromoCode",value:this.state.promoCode,onChange:this.toStorePromoCode})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Target Account:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtAccount",value:this.state.account,onChange:this.toStoreAccount})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Ether Deposited:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtEtherDeposited",value:this.state.amount,onChange:this.toStoreAmount})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Ether per account:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtEtherPerAccount",value:this.state.ether,onChange:this.toStoreEther})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Starting Date:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"datetime-local",class:"form-control",name:"txtStartingDate",value:this.state.startDate,onChange:this.toStoreStartDate})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Ending Date:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"datetime-local",class:"form-control",name:"txtEndingDate",value:this.state.endDate,onChange:this.toStoreEndDate})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Min Spending Amount:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtMinSpendingAmount",value:this.state.minSpendingAmt,onChange:this.toStoreMinSpendingAmt})})]}),Object(B.jsxs)("tr",{style:{height:"45px"},children:[Object(B.jsx)("td",{children:"Max Spending Amount:"}),Object(B.jsx)("td",{children:Object(B.jsx)("input",{type:"text",class:"form-control",name:"txtMaxSpendingAmount",value:this.state.maxSpendingAmt,onChange:this.toStoreMaxSpendingAmt})})]})]})}),Object(B.jsxs)(y.a.Footer,{children:[Object(B.jsx)("button",{type:"button",class:"btn btn-success",onClick:this.CreateNewPromotion,id:"btn_CreateNewPromotion",children:"Add New Promotion"}),Object(B.jsx)("button",{type:"button",class:"btn btn-danger",onClick:this.close,children:"Close"})]})]})]})}}]),n}(a.a.Component),V=L,z=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,539)).then((function(e){var n=e.getCLS,o=e.getFID,a=e.getFCP,s=e.getLCP,i=e.getTTFB;n(t),o(t),a(t),s(t),i(t)}))};i.a.render(Object(B.jsx)(a.a.StrictMode,{children:Object(B.jsx)(V,{})}),document.getElementById("root")),z()},78:function(t,e,n){}},[[533,1,2]]]);
//# sourceMappingURL=main.d2836b99.chunk.js.map